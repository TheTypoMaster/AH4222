<html>
  <head>
    <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
    <!--<link rel="stylesheet" href='stylemain.css' type='text/css'>
         <link rel="stylesheet" href='colors.css' type='text/css'>-->
    <link rel="stylesheet" href='club.css' type='text/css'>   
            <script language="javascript" src="util.js"></script>
            <script language="javascript">
<!-- hide

var state = '<%ejGetSntp(sntpRefresh)%>';
if ( state == '1' ) {
   if (isNetscape())
      var code = 'location.replace("sntpcfg.sntp?sntpRefresh=0")';
   else
      var code = 'location.assign("sntpcfg.sntp?sntpRefresh=0")';
   eval(code);
}

var ntpServers = new Array();

ntpServers[0] = 'clock.fmt.he.net';
ntpServers[1] = 'clock.nyc.he.net';
ntpServers[2] = 'clock.sjc.he.net';
ntpServers[3] = 'clock.via.net';
ntpServers[4] = 'ntp1.tummy.com';
ntpServers[5] = 'time.cachenetworks.com';
ntpServers[6] = 'time.nist.gov';
ntpServers[7] = 'time.windows.com';

var timeZones = new Array();

timeZones[0] = '(GMT-12:00) International Date Line West';
timeZones[1] = '(GMT-11:00) Midway Island, Samoa';
timeZones[2] = '(GMT-10:00) Hawaii';
timeZones[3] = '(GMT-09:00) Alaska';
timeZones[4] = '(GMT-08:00) Pacific Time, Tijuana';
timeZones[5] = '(GMT-07:00) Arizona, Mazatlan';
timeZones[6] = '(GMT-07:00) Chihuahua, La Paz';
timeZones[7] = '(GMT-07:00) Mountain Time';
timeZones[8] = '(GMT-06:00) Central America';
timeZones[9] = '(GMT-06:00) Central Time';
timeZones[10] = '(GMT-06:00) Guadalajara, Mexico City, Monterrey';
timeZones[11] = '(GMT-06:00) Saskatchewan';
timeZones[12] = '(GMT-05:00) Bogota, Lima, Quito';
timeZones[13] = '(GMT-05:00) Eastern Time';
timeZones[14] = '(GMT-05:00) Indiana';
timeZones[15] = '(GMT-04:00) Atlantic Time';
timeZones[16] = '(GMT-04:00) Caracas, La Paz';
timeZones[17] = '(GMT-04:00) Santiago';
timeZones[18] = '(GMT-03:30) Newfoundland';
timeZones[19] = '(GMT-03:00) Brasilia';
timeZones[20] = '(GMT-03:00) Buenos Aires, Georgetown';
timeZones[21] = '(GMT-03:00) Greenland';
timeZones[22] = '(GMT-02:00) Mid-Atlantic';
timeZones[23] = '(GMT-01:00) Azores';
timeZones[24] = '(GMT-01:00) Cape Verde Is.';
timeZones[25] = '(GMT) Casablanca, Monrovia';
timeZones[26] = '(GMT) Greenwich Mean Time: Dublin, Edinburgh, Lisbon, London';
timeZones[27] = '(GMT+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna';
timeZones[28] = '(GMT+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague';
timeZones[29] = '(GMT+01:00) Brussels, Copenhagen, Madrid, Paris';
timeZones[30] = '(GMT+01:00) Sarajevo, Skopje, Warsaw, Zagreb';
timeZones[31] = '(GMT+01:00) West Central Africa';
timeZones[32] = '(GMT+02:00) Athens, Istanbul, Minsk';
timeZones[33] = '(GMT+02:00) Bucharest';
timeZones[34] = '(GMT+02:00) Cairo';
timeZones[35] = '(GMT+02:00) Harare, Pretoria';
timeZones[36] = '(GMT+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius';
timeZones[37] = '(GMT+02:00) Jerusalem';
timeZones[38] = '(GMT+03:00) Baghdad';
timeZones[39] = '(GMT+03:00) Kuwait, Riyadh';
timeZones[40] = '(GMT+03:00) Moscow, St. Petersburg, Volgograd';
timeZones[41] = '(GMT+03:00) Nairobi';
timeZones[42] = '(GMT+03:30) Tehran';
timeZones[43] = '(GMT+04:00) Abu Dhabi, Muscat';
timeZones[44] = '(GMT+04:00) Baku, Tbilisi, Yerevan';
timeZones[45] = '(GMT+04:30) Kabul';
timeZones[46] = '(GMT+05:00) Ekaterinburg';
timeZones[47] = '(GMT+05:00) Islamabad, Karachi, Tashkent';
timeZones[48] = '(GMT+05:30) Chennai, Kolkata, Mumbai, New Delhi';
timeZones[49] = '(GMT+05:45) Kathmandu';
timeZones[50] = '(GMT+06:00) Almaty, Novosibirsk';
timeZones[51] = '(GMT+06:00) Astana, Dhaka';
timeZones[52] = '(GMT+06:00) Sri Jayawardenepura';
timeZones[53] = '(GMT+06:30) Rangoon';
timeZones[54] = '(GMT+07:00) Bangkok, Hanoi, Jakarta';
timeZones[55] = '(GMT+07:00) Krasnoyarsk';
timeZones[56] = '(GMT+08:00) Beijing, Chongquing, Hong Kong, Urumqi';
timeZones[57] = '(GMT+08:00) Irkutsk, Ulaan Bataar';
timeZones[58] = '(GMT+08:00) Kuala Lumpur, Singapore';
timeZones[59] = '(GMT+08:00) Perth';
timeZones[60] = '(GMT+08:00) Taipei';
timeZones[61] = '(GMT+09:00) Osaka, Sapporo, Tokyo';
timeZones[62] = '(GMT+09:00) Seoul';
timeZones[63] = '(GMT+09:00) Yakutsk';
timeZones[64] = '(GMT+09:30) Adelaide';
timeZones[65] = '(GMT+09:30) Darwin';
timeZones[66] = '(GMT+10:00) Brisbane';
timeZones[67] = '(GMT+10:00) Canberra, Melbourne, Sydney';
timeZones[68] = '(GMT+10:00) Guam, Port Moresby';
timeZones[69] = '(GMT+10:00) Hobart';
timeZones[70] = '(GMT+10:00) Vladivostok';
timeZones[71] = '(GMT+11:00) Magadan';
timeZones[72] = '(GMT+11:00) Solomon Is., New Caledonia';
timeZones[73] = '(GMT+12:00) Auckland, Wellington';
timeZones[74] = '(GMT+12:00) Fiji, Kamchatka, Marshall Is.';

function getTimeZoneIndex(timeZoneName) {
  var i = 0, ret = 4;  // default to Pacific time

  for ( var i = 0; i < timeZones.length; i++ ) {
    if ( timeZones[i].search(timeZoneName) != -1 )
      break;
  }

  if ( i < timeZones.length )
    ret = i;

  return ret;
}

function getTimeZoneName(idx) {
  var str = timeZones[idx];
  var ret = '';

  if ( idx != 25 && idx != 26 )
    ret = str.substr(12);
  else
    ret = str.substr(6);

  return ret;
}

function getTimeZoneOffset(idx) {
  var str = timeZones[idx];
  var ret = '';

  if ( idx != 25 && idx != 26 )
    ret = str.substr(4, 6);

  return ret;
}

function writeTimeZoneList() {
  for( var i = 0; i < timeZones.length; i++ )
    document.writeln("<option value=" + getTimeZoneOffset(i) + ">" + timeZones[i] + "</option>");
}

function ntpChange(optionlist,textbox) {
  if( optionlist[optionlist.selectedIndex].value == "Other" )
    textbox.disabled = false;
  else {
    textbox.value = "";
    textbox.disabled = true;
  }
}

function btnApply() {
  var loc = 'sntpcfg.sntp?ntp_enabled=';
  var flag = 1;
  var second_flag = 1;
  var isDomain;
  var withDot;

  with( document.forms[0] ) {
    if( ntpEnabled.checked ) {
      loc += '1&ntpServer1=';
      if( ntpServer1.selectedIndex == ntpServers.length ) 
      {
         isDomain = 0;
         withDot = 0;
         if( ntpServerOther1.value.length == 0 ) 
         { // == Other
            alert('"Autre" est sélectionné pour le premier serveur de temps, merci de remplir le champs associé.');
            return;
         } 
         else if( ntpServerOther1.value.length > 25 )
         {
            alert('La longueur du nom de la Premier serveur de temps NTP ' +  ntpServerOther1.value.length  + ' est supérieure à la longueur autorisée [0-25]');
            return;
         }
         else
         {

            for(var i=0; i< ntpServerOther1.value.length; i++)
            {
               if((isDigit(ntpServerOther1.value.charAt(i)) == false) && (ntpServerOther1.value.charAt(i) != '.'))
               {
                  isDomain = 1;
                  break;
               }
            }
           
            if(isDomain == 0)
            {
               if(isValidIpAddress(ntpServerOther1.value) == false)
                  flag = 0;
            }      
            else 
            {
               flag = 0;
               for(var k=0; k < ntpServerOther1.value.length; k++)
               {           
                  if(ntpServerOther1.value.charAt(k) == '.')
                  {
                     flag = 1;
                     break;
                  }
               }
            }
           
            if(flag == 0)
            {
                 alert(ntpServerOther1.value + " n'est pas une adresse IP ou un nom de domaine valide.");
                 return;
            }
            loc += ntpServerOther1.value;
         }
      } 
      else 
        loc += ntpServer1[ntpServer1.selectedIndex].value;

      loc += '&ntpServer2=';
      if( ntpServer2.selectedIndex == ntpServers.length+1 ) 
      {
         isDomain = 0;
         withDot = 0;
         if( ntpServerOther2.value.length == 0 ) 
         { // == Other
            alert('"Autre" est sélectionné pour le second serveur de temps, merci de remplir le champs associé.');
            return;
         } 
         else if(ntpServerOther2.value.length > 25)
         {
            alert('La longueur du nom de la Second serveur de temps NTP ' + ntpServerOther1.value.length + ' est supérieure à la longueur autorisée [0-25]');
            return;
         }
         else 
         {
            for(var i=0; i< ntpServerOther2.value.length; i++)
            {
               if((isDigit(ntpServerOther2.value.charAt(i)) == false) && (ntpServerOther2.value.charAt(i) != '.'))
               {
                  isDomain = 1;
                  break;
               }
            }
           
            if(isDomain == 0)
            {
               if(isValidIpAddress(ntpServerOther2.value) == false)
                  second_flag = 0;
            }      
            else 
            {
               second_flag = 0;
               for(var k=0; k < ntpServerOther2.value.length; k++)
               {           
                  if(ntpServerOther2.value.charAt(k) == '.')
                  {
                     second_flag = 1;
                     break;
                  }
               }
            }
           
            if(second_flag == 0)
            {
               alert(ntpServerOther2.value + " n'est pas une adresse IP ou un nom de domaine valide.");
               return;
            }
         }
         loc += ntpServerOther2.value;
      } 
      else 
      {
           if( ntpServer2.selectedIndex > 0 )
              loc += ntpServer2[ntpServer2.selectedIndex].value;
      }

      loc += '&timezone_offset=' + cboTimeZone[cboTimeZone.selectedIndex].value;
      loc += '&timezone=' + getTimeZoneName(cboTimeZone.selectedIndex);
      loc += '&use_dst=0';
    } else {
      loc += '0';
    }
  }
  if (isNetscape())
     var code = 'location.replace("' + loc + '")';
  else
     var code = 'location.assign("' + loc + '");';
  eval(code);
}

function frmLoad() {
  var i = 0;
  var ntp1 = "<%ejGetSntp(ntpServer1)%>";
  var ntp2 = "<%ejGetSntp(ntpServer2)%>";
  var ntp_enabled = "<%ejGetSntp(ntp_enabled)%>";
  var tz_name = "<%ejGetSntp(timezone)%>";

  with (document.forms[0]) {
    if( ntp_enabled == "1" ) {
      ntpEnabled.checked = true;
    } else {
      ntpEnabled.checked = false;
    }

    if( ntp1.length ) {
      for( i = 0; i < ntpServers.length; i++ ) {
        if( ntp1 == ntpServers[i] ) {
          ntpServer1.selectedIndex = i;
          break;
        }
      }
      if( i == ntpServers.length ) {
        ntpServer1.selectedIndex = i; // Set to 'Other'
        ntpServerOther1.value = ntp1;
      }
    }
    ntpChange(ntpServer1,ntpServerOther1);

    if( ntp2.length ) {
      for( i = 0; i < ntpServers.length; i++ ) {
        if( ntp2 == ntpServers[i] ) {
          ntpServer2.selectedIndex = i+1;
          break;
        }
      }
      if( i == ntpServers.length ) {
        ntpServer2.selectedIndex = i+1; // Set to 'Other'
        ntpServerOther2.value = ntp2;
      }
    }
    ntpChange(ntpServer2,ntpServerOther2);

    cboTimeZone.selectedIndex = getTimeZoneIndex(tz_name);

    ntpEnblChange();
  }
  move_position();
}

function hideNtpConfig(hide) {
  var status = 'visible';

  if(hide)
    status = 'hidden';

  if( document.getElementById )
    document.getElementById('ntpConfig').style.visibility = status;
  else
    if(!document.layers)
      document.all.ntpConfig.style.visibility = status;
  move_position();
}

function ntpEnblChange() {
  if( document.forms[0].ntpEnabled.checked )
    hideNtpConfig(0);
  else
    hideNtpConfig(1);
}

function writeNtpList(needed) {
  if(!needed)
    document.writeln("<option value=None>None</option>");
  for( var i = 0; i < ntpServers.length; i++ )
    document.writeln("<option value=" + ntpServers[i] + ">" + ntpServers[i] + "</option>");
  document.writeln("<option value=Other>Autre</option>");
}

function move_position()
{
   var ntp_sta = document.getElementById('ntpConfig').style.visibility;

   if(ntp_sta == 'hidden')
   {
      document.getElementById('ntpConfig').style.position = 'absolute';
      document.getElementById('ntpConfig').style.top = '-1000';
      document.getElementById('ntpConfig').style.top = '-1000';
   }
   else
   {
      document.getElementById('ntpConfig').style.position = 'static';
      document.getElementById('ntpConfig').style.top = '0';
      document.getElementById('ntpConfig').style.top = '0';
   }
}

// done hiding -->
    </script>
  </head>
  <body onLoad='frmLoad()'>
    <blockquote>
      <form>
            <img src='titres/titre_gestion.gif' width='270' height='25'><br>
            <hr width='597' color='#afb3b5' size='4' align='left'>
            <table border='0' cellpadding='3' cellspacing='0' width='597'>
            <tr bgcolor='#e2007a' height='20'><td nowrap><font class='mainCharacter'>Réglages de l'heure</font></td></tr></table>
            <table border='0' cellpadding='3' cellspacing='0' width='597'>
            <tr bgcolor='#f2f2f2'><td class='content1'>&nbsp;</td></tr>
            <tr bgcolor='#f2f2f2'><td class='content1'>Cette page permet d'accéder à la configuration de l'heure de votre modem.</td></tr>
            <tr bgcolor='#f2f2f2'><td class='content1'>Vous pouvez entrer votre propre serveur de temps NTP en sélectionnant  le champ « Autre ».</td></tr>
            <tr bgcolor='#f2f2f2'><td class='content1'>&nbsp;</td></tr>
            <tr bgcolor='#f2f2f2'><td class='content1'><input type='checkbox' name='ntpEnabled' onClick='ntpEnblChange()'>&nbsp;&nbsp;
               Synchronisation automatique avec les serveurs Internet de temps </td></tr>
            <tr bgcolor='#f2f2f2'><td class='content1'>&nbsp;</td></tr>
            </table>
            <div id='ntpConfig'>
            <table border='0' cellpadding='3' cellspacing='0' width='597'>
            <tr bgcolor='#f2f2f2'><td class='content1' width='150'>Premier serveur de temps NTP:</td>
              <td><select name='ntpServer1' size="1" onChange='ntpChange(this.form.ntpServer1,this.form.ntpServerOther1)'>
                    <script language="javascript">
                      writeNtpList(true);
                    </script>
                  </select>
              </td>
              <td><input type='text' name='ntpServerOther1'></td></tr>
            <tr bgcolor='#f2f2f2'><td class='content1' width='150'>Second serveur de temps NTP:</td>
              <td><select name='ntpServer2' size="1" onChange='ntpChange(this.form.ntpServer2,this.form.ntpServerOther2)'>
                    <script language="javascript">
                      writeNtpList(false);
                    </script>
                  </select>
              </td>
              <td><input type='text' name='ntpServerOther2'></td></tr>
            <tr bgcolor='#f2f2f2'><td class='content1' width='150'>Fuseau Horaire:</td>
              <td colspan=2><select name='cboTimeZone' size="1">
                    <script language="javascript">
                      writeTimeZoneList();
                    </script>
                  </select>
              </td></tr>
            <tr bgcolor='#f2f2f2'><td class='content1' colspan='3'>&nbsp;</td></tr>
            </table>
            </div>
            <br>
            <table width='597'><tr><td align='center'>
            <img border='0' onClick='btnApply()' src='button/btn_sauver_appliquer_on.gif' hspace='6' vspace='6' width='160' height='23' style="CURSOR: hand">
            </td></tr></table>
        <!--<center>
        <input type='button' value="Save/Apply" onClick='btnApply()'>
        </center>-->
      </form>
    </blockquote>
  </body>
</html>
